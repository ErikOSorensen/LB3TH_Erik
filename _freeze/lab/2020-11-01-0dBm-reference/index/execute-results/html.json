{
  "hash": "b7651650a3554637baa6548810697fac",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Attempting a 0dBm reference\"\ndescription: \"Attempting a 0dBm reference\"\ndate: 2020-11-01\ncategories: [0dBm]\n---\n\n\n\n> Warning: This is my lab notebook, there are some bad turns and mistakes along the way,\n> but I think I sort it out in the end.\n\n# Motivation\n\nI have plans (and have built the analog part) for an RF power meter of the AD8307\ntype. This needs to be calibrated. For the initial tests, I was quite happy that\nI got reasonable results interpreting the output from my HP8657a RF signal generator.\nWhen it was new and calibrated, it promised ±1 dB level accuracy (typically ±0.5 dB),\nbut it is old, and for small power levels my scope cannot provide good measurements.\n\nSo it would be perfect to have a reference that could be used to calibrate my power\nmeter—perhaps in conjunction with some Mini-Circuits attenuators that I have and trust.\n\n# Design and build\n\nI came across a circuit online which seems to promise a no-tune calibrator. It is\nknown as the DL7AV calibrator, and [Hans Summers built one in a YouTube\nvideo](https://youtu.be/732ESoul088). I attempted a modification to 10 MHz; this is\nthe version that I originally built (mistakes and all).\n\nThe plan is that Q1 will not amplify unless there is positive bias at the gate,\nand this is controlled by the op-amp. Following Q1, there is a low-pass filter\n(calculated using the [rf-tools calculator](https://rf-tools.com/lc-filter/)).\nThe filter is necessary to guarantee a fairly pure tone, since we will be\ncalibrating power based on voltage peak-to-peak readings.\n\nThis is rectified, and the op-amp compares the peak of this filtered signal with\nthe 5 V reference (U1). If the rectified signal is smaller than 5 V, U2 increases\nthe bias at Q1's gate, until there is 5 V before the attenuator. The control-loop\nshould be low impedance, so I add a 50 ohm resistor.\n\n5 V peak into 50 ohms is:\n\n$$\n(5V/\\sqrt{2})^2/50\\Omega = 0.25W\n= 10\\log_{10}(250mW/1mW)\\,\\mathrm{dBm}\n= 23.97\\,\\mathrm{dBm}.\n$$\n\nThe schematic shows exact values for a 23.97 dB attenuator, but commercial values\n(390 and 56 ohm) are close enough at 24.1 dB.\n\nThere are some assumptions about the op-amp not loading down the rectified RF (so\nthat we measure true peaks). The original circuit used a LF356. The TL072 is\ndefinitely not rail-to-rail (but I bought a lot of these on eBay a while back).\nI did not plan on battery operation, so I used a 12 V supply.\n\nThis is what the first build looked like:\n\n![Board on bench](images/0dBm-board.jpg)\n\n## First power-up experience\n\nThe experience was: too much current; the supply drooped to just over 7.1 V at\n100 mA. At that point, the rectified DC at the op-amp was short of the voltage\nreference, the op-amp output was probably around 5.5 V, and bias at the Q1 gate\nwas 4.24 V.\n\nHowever, I was measuring about 200 mV rms on the output (terminated with 50 ohm),\nwhich is in the neighborhood of the 225 mV of 0 dBm. The circuit was burning hot,\nin a bias-restricted equilibrium.\n\nAfter some fiddling with parts, looking for short circuits, and replacing the RF\nchoke (25 turns on FT50-43), things improved slightly. The point of this choke is\nto provide a high resistance to RF, such that RF would rather enter the low-pass\nfilter than the power supply.\n\nFor input signal, I tried both my Colpitts oscillator from a previous post, but\nsettled on something similar to what Hans Summers used: a 5 V square wave from my\nRigol function generator.\n\nTrying to figure out what was wrong, I connected the second channel of my PSU to\nthe midpoint of R2 and R3 and adjusted until I had 223 mV at the output. I found\nthat I could reach this with a bias at 3.867 V, at which point the current from the\nsupply was about 55 mA. So a higher bias eventually led to less output.\n\n## Trying to fix the unstable bias\n\nThat a higher bias eventually leads to lower output is perhaps not so strange:\nwith sufficiently high bias, the signal is not able to modulate the drain, because\nQ1 is always on.\n\nThe question is what the op-amp will do on startup. At first there is no bias, so\nno RF to be rectified, and the op-amp will try to drive the gate hard. If it drives\nthe gate too hard, it will get past the unstable high-bias equilibrium and go into\ncurrent limitation.\n\nOne possibility is to restrict the initial bias by installing a large electrolytic\ncapacitor to ground between R2 and R3. I tried a 220 µF capacitor. It slows down the\nturn-on, but it eventually reaches the same level.\n\n## More measurement\n\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n:::\n\n\nThe dashed line represents the target of 224 mV (rms) into 50 ohm, i.e. 0 dBm.\n\n## Attenuation\n\nI have a pi attenuator with 50 ohm in and out. Following the EMIRFD formulas:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nRP <- function(R, V) R * (1 + V) / (1 - V)\nRS <- function(R, V) 2 * R^2 * RP(R, V) / (RP(R, V)^2 - R^2)\n\nRP(50, sqrt(0.1) / 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 56.75156\n```\n\n\n:::\n\n```{.r .cell-code}\nRS(50, sqrt(0.1) / 5)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 393.7036\n```\n\n\n:::\n:::\n\n\n# Conclusion\n\nSo a bit off, but taking into account tolerances, being less than a dB off is not\nso bad. Some trimming in the final build should be able to sort that out.\n\n![Final schematic](images/0dBm-calibrator_v2.png)\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}